<!DOCTYPE HTML>
<html>
<head>
    <meta content="text/html;charset=utf-8" http-equiv="Content-Type">
    <meta content="utf-8" http-equiv="encoding">
    <title>Armo</title>
    <script src= "babylon.js"></script>
    <script src="babylonObjLoader.js"></script>
    <style>
        html, body, div, canvas {
            width: 100%;
            height: 100%;
            padding: 0;
            margin: 0;
        }
    </style>
</head>
<body>
<canvas id="canvas"></canvas>


<script>


    // Check support
    if (!BABYLON.Engine.isSupported()) {
        window.alert('Browser not supported');
    } else {
        var canvas = document.getElementById("canvas");
        var engine = new BABYLON.Engine(canvas, true);


        //scene setup

        var scene = new BABYLON.Scene(engine);

        var camera = new BABYLON.ArcRotateCamera("Camera", 0, 0, 0, BABYLON.Vector3.Zero(), scene);
        camera.setPosition(new BABYLON.Vector3(0,15,-10));
        camera.attachControl(canvas, false);

        var light = new BABYLON.HemisphericLight("light", new BABYLON.Vector3(0, 1, 0), scene);
        light.intensity=0.7;

        var ground= BABYLON.Mesh.CreateGround("ground1",100,100,2,scene);
        var matGround=new BABYLON.StandardMaterial("ground1",scene);
        matGround.diffuseTexture=new BABYLON.Texture("grass.jpg",scene);
        ground.material=matGround;

        //creation of wall
        var wall1 = {
            width: 100,
            height: 50,
            depth: 5,

        };

        var wall2 = {
            width: 5,
            height: 50,
            depth: 100,

        };

        var box1=BABYLON.MeshBuilder.CreateBox("box0",wall1,scene);
        box1.position.z=50;
        box1.visibility=0;

        var box2=BABYLON.MeshBuilder.CreateBox("box2",wall1,scene);
        box2.position.z=-50;
        box2.visibility=0;

        var box3=BABYLON.MeshBuilder.CreateBox("box3",wall2,scene);
        box3.position.x=50;
        box3.visibility=0;

        var box4=BABYLON.MeshBuilder.CreateBox("box4",wall2,scene);
        box4.position.x=-50;
        box4.visibility=0;

        var score=0;

        //Import Main Character
       var char=new BABYLON.SceneLoader.ImportMesh("","design/", "char.obj", scene, function(newMeshes,particleSystems,skeletons){
            var char = newMeshes[0];
           var bone = BABYLON.MeshBuilder.CreateBox("bone",2,scene);
            bone.visibility = 0;
            char.parent  = bone;
           char.materials=new BABYLON.Texture("steel.jpg",scene);
           char.position=new BABYLON.Vector3(0,0,0);
           scene.beginAnimation(skeletons[0], 0, 60, true, 1.0);
        });
        
        

        //Import Enemy
        
        var enemies=[];
        
        var createEnemy=function(){
        BABYLON.SceneLoader.ImportMesh("","design/", "enemy.babylon", scene, function(newMeshes, particleSystems){
            e = newMeshes[0];
            var bone1 = BABYLON.MeshBuilder.CreateBox("bone1",2,scene);
            bone1.visibility = 0;
            e.parent  = bone1;
            
            enemy=e;

        });
            
            var devil=enemy.clone("devil");
            posx=Math.floor(Math.random());
            devil.position =new BABYLON.Vector3(posx,3,posx);
            enemy.killed=false;
            enemy.isVisible=true;
            enemies.push(devil);
        };
        
        setInterval(createEnemy, 1000);

//Applying collision

        function enableCameraCollision(camera, scene) {
            // Enable gravity on the scene. Should be similar to earth's gravity.
            scene.gravity = new BABYLON.Vector3(0, -0.98, 0);
            // Enable collisions globally.
            scene.collisionsEnabled = true;
            // Enable collision detection and gravity on the free camera.
            camera.checkCollisions = true;
            camera.applyGravity = true;
            // Set the player size, the camera's ellipsoid.
            camera.ellipsoid = new BABYLON.Vector3(0.4, 0.8, 0.4);
            //Collisions on ground,main character and enemy
            ground.checkCollisions = true;
            char.checkCollisions = true;
            enemy.checkCollisions = true;
        }

        
       function cleanDevil() {
    // For all clones
    for (var n=0; n<enemies.length; n++) {
        // The mushrooms has been killed !
        if (enemies[n].killed) {
            var devil = ENEMIES[n];
            // Destroy the clone !
            devil.dispose();
            ENEMIES.splice(n, 1);
            n--;
            // Add one point to the score
            score += 1;
        }
    
    }
}
        
        
        
        //render
        engine.runRenderLoop(function() {
            cleanDevil();
            scene.render();
        });


        
        
        

/*var timerText;

function Start () {
    reloadTimer(30);
}

function reloadTimer(reloadTimeInSeconds : float){
    var counter = 0;

    while (counter < reloadTimeInSeconds)
    {
        counter += Time.deltaTime;
        timerText.text = counter.ToString();
        yield;
    }

    scene.render();
}*/


        /*SCENE END*/

        // Keyboard event start
        window.onkeydown=function(event){
            event=event || window.event;
            var keyCode=event.which ||event.keyCode;


            switch(keyCode){
                case 87 :
                    char.position.z+=0.05;
                    break;

                case 65:
                    char.position.x-=0.05;
                    break;
                case 83:
                    char.position.z -=0.05;
                    break;
                case 68:
                    char.position.x +=0.05;
                    break;

            }
        };
    }

    /*      engine.runRenderLoop(function(){

     scene.render();
     })



     var renderLoop = function () {
     scene.render();
     };
     engine.runRenderLoop(renderLoop);

     var alpha = 0;
     knot.scaling.y = 1.5;

     scene.beforeRender = function() {
     knot.rotation.y = alpha;

     alpha += 0.03;

     }; */



    /*


     /*SCENE END*/

    /* Keyboard event start
     window.onkeydown=function(event){
     event=event || window.event;
     var keyCode=event.which ||event.keyCode; */

    /*          
     switch(keyCode){
     case 87 :
     head.position.z+=0.05;
     break;

     case 65:
     head.position.x-=0.05;
     break;
     case 83:
     head.position.z -=0.05;
     break;
     case 68:
     head.position.x +=0.05;
     break;

     }; */


    // Once the scene is created, just register a render loop to render it


    /* // Resize
     window.addEventListener("resize", function () {
     engine.resize();
     }); */

</script>
</body>
</html>